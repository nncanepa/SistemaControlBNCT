
<!DOCTYPE html>
<style type="text/css">

.titulo{
    font-family: "Courier";   
    font-size: 14px;
      text-align: center;
      display: block;
      color: #aaaaaa; /*color numeros*/
      background-color:#000000;
      width: 698px;
  }
    
.valor{
  font-family: "Impact";
  font-size: 14px;
  display: block;
  text-align: center;
  min-width: 55px;
  color: #ffdd00; /*color numeros*/
}

body{background-color: #333333;
}

table{
  background-color: #282828;
  border: 1px solid black;
}
#tabla_medicion_normal{background-color: #337333;}
#tabla_medidion_error{background-color: #933333;}

</style>

<html>
<script type="text/javascript" src="./js/smoothie.js"></script>

<body>
  <table id=tabla_medicion_normal>
    <tbody>
      <td>
        <table id="Corriente_FAR">
          <tbody>
            <tr><td><label class="titulo" id="titulo_Corriente_FAR"><details><summary>Corriente</summary>ESP 9 Supresora y Faraday Cup</details></label></td></tr>
            <td><label class="valor">Medici√≥n de Corriente en la Copa de Faraday (mA)</label></td>
          </tbody>
        </table>    
        <canvas id="mycanvas_FAR" width="705px" height="130px"></canvas>
     </td>

     <td>
        <table id="Corriente_TOTAL">
          <tr><td colspan="9"><label class="titulo" id="titulo_Corriente_TOTAL"><details><summary>Corrientes medias por nivel (mA)</summary>Niveles: 100 200 300 400 500 600 </details></label></td></tr>
          <td ><label class="valor" id="Valor_Nivel_100_CUP">--</label></td>
          <td ><label class="valor" id="Valor_Nivel_200_CUP">--</label></td>
          <td ><label class="valor" id="Valor_Nivel_300_CUP">--</label></td>
          <td ><label class="valor" id="Valor_Nivel_400_CUP">--</label></td>
          <td ><label class="valor" id="Valor_Nivel_500_CUP">--</label></td>
          <td ><label class="valor" id="Valor_Nivel_600_CUP">--</label></td>
        </table>
        <canvas id="mycanvas_TOTAL" width="705px" height="130px"></canvas>   
      </td>
    </tbody>
  </table>
</body>  
<script type="text/javascript">
      ws = new WebSocket("ws://127.0.0.1:4000")
      var p=0
      var n_orden=1;
      var line_100 = new TimeSeries();
      var line_200 = new TimeSeries();
      var line_300 = new TimeSeries();
      var line_400 = new TimeSeries();
      var line_500 = new TimeSeries();
      var line_600 = new TimeSeries();
      var smoothie = new SmoothieChart({interpolation:'linear',minValue:0,millisPerPixel: 60,
      grid: { strokeStyle: 'rgb(0,80,  0)', fillStyle: 'rgb(0,30, 0)', lineWidth: 1, millisPerLine: 600  , verticalSections: 6 } });
      smoothie.addTimeSeries(line_100, { strokeStyle: 'rgb(255,   0,   0)', fillStyle: 'rgba(  0, 255,   0, 0)', lineWidth: 2 });
      smoothie.addTimeSeries(line_200, { strokeStyle: 'rgb(  0, 255,   0)', fillStyle: 'rgba(255,   0, 255, 0)', lineWidth: 2 });
      smoothie.addTimeSeries(line_300, { strokeStyle: 'rgb(  0,   0, 255)', fillStyle: 'rgba(255,   0, 255, 0)', lineWidth: 2 });
      smoothie.addTimeSeries(line_400, { strokeStyle: 'rgb(255, 255,   0)', fillStyle: 'rgba(255,   0, 255, 0)', lineWidth: 2 });
      smoothie.addTimeSeries(line_500, { strokeStyle: 'rgb(255,   0, 255)', fillStyle: 'rgba(255,   0, 255, 0)', lineWidth: 2 });
      smoothie.addTimeSeries(line_600, { strokeStyle: 'rgb(  0, 255, 255)', fillStyle: 'rgba(255,   0, 255, 0)', lineWidth: 2 });
      smoothie.streamTo(document.getElementById("mycanvas_TOTAL"), 500);
      
      var line_FAR = new TimeSeries();
      var line_SUP = new TimeSeries();
      var smoothie = new SmoothieChart({interpolation:'linear',minValue:0,millisPerPixel: 60,
      grid: { strokeStyle: 'rgb(0,80,  0)', fillStyle: 'rgb(0,30, 0)', lineWidth: 1, millisPerLine: 600  , verticalSections: 6 } });
      smoothie.addTimeSeries(line_FAR, { strokeStyle: 'rgb(255,   0,   0)', fillStyle: 'rgba(  0, 255,   0, 0)', lineWidth: 2 });
      smoothie.addTimeSeries(line_SUP, { strokeStyle: 'rgb(  0, 255,   0)', fillStyle: 'rgba(255,   0, 255, 0)', lineWidth: 2 });
      smoothie.streamTo(document.getElementById("mycanvas_FAR"), 500);
      
      
      ws.onmessage = function (event) {
        var nombre_fuentes=["Nivel_100_ACE_getI","Nivel_100_CUP_getI","Nivel_200_CDO_getI","Nivel_200_ACE_getI","Nivel_200_CUP_getI",
        "Nivel_300_getI","Nivel_400_getI","Nivel_500_getI","Nivel_600_getI","Nivel_SUP_getI","Nivel_FAR_getI"]
        var data = JSON.parse(event.data);
        // console.log(data)
        
        val_100=(Number(data.Nivel_100_ACE_getI)+Number(data.Nivel_100_CUP_getI))/2
        val_200=(Number(data.Nivel_200_ACE_getI)+Number(data.Nivel_200_CUP_getI)+Number(data.Nivel_200_CDO_getI))/3
        val_300=Number(data.Nivel_300_getI)
        val_400=Number(data.Nivel_400_getI)
        val_500=Number(data.Nivel_500_getI)
        val_600=Number(data.Nivel_600_getI)
        val_sup=Number(data.Nivel_SUP_getI)
        val_far=Number(data.Nivel_FAR_getI)
        // console.log(val_far)
        if (data){
            line_100.append(new Date().getTime(), val_100);
            line_200.append(new Date().getTime(), val_200);
            line_300.append(new Date().getTime(), val_300);
            line_400.append(new Date().getTime(), val_400);
            line_500.append(new Date().getTime(), val_500);
            line_600.append(new Date().getTime(), val_600);
            try{document.getElementById('Valor_Nivel_100_CUP').innerHTML=val_100.toFixed(1) + ' mA';}catch(error){}
            try{document.getElementById('Valor_Nivel_200_CUP').innerHTML=val_200.toFixed(1) + ' mA';}catch(error){}
            try{document.getElementById('Valor_Nivel_300_CUP').innerHTML=val_300.toFixed(1) + ' mA';}catch(error){}
            try{document.getElementById('Valor_Nivel_400_CUP').innerHTML=val_400.toFixed(1) + ' mA';}catch(error){}
            try{document.getElementById('Valor_Nivel_500_CUP').innerHTML=val_500.toFixed(1) + ' mA';}catch(error){}
            try{document.getElementById('Valor_Nivel_600_CUP').innerHTML=val_600.toFixed(1) + ' mA';}catch(error){}

            line_FAR.append(new Date().getTime(), val_far);
            line_SUP.append(new Date().getTime(), val_sup);
          }
            
        if (data.count==1 && p==0){
          setInterval(function timer(){
          var sms={}
          if (n_orden==1) {sms.corrientes='';n_orden=0}else{
            sms.tensiones='';n_orden=1;  
          }
          
              ws.send(JSON.stringify(sms));
              },200)
          p=1;

          }
      }
      ws.onclose= function(event){
        document.getElementById("tabla_medicion_normal").id='tabla_medidion_error';
      }
</script>

</html>